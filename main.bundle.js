(()=>{"use strict";class t{routes=[];currentPath="";previousPath=null;constructor(t="hash"){this.mode=t,this.currentPath=this.getFragment(),window.addEventListener("hash"===this.mode?"hashchange":"popstate",(()=>this.handleRouteChange())),this.adjustLinksForGHPages()}adjustLinksForGHPages(){{const t="/otus-SPA-turarov-2023";document.querySelectorAll("a").forEach((e=>{e.href=t+e.pathname}))}}getFragment(){return"history"===this.mode?decodeURI(window.location.pathname+window.location.search):window.location.hash.slice(1)}async handleRouteChange(){this.previousPath=this.currentPath,this.currentPath=this.getFragment();const e={currentPath:this.currentPath,previousPath:this.previousPath,state:history.state};for(const o of this.routes)t.isMatch(o.match,this.currentPath)&&(o.onBeforeEnter&&await o.onBeforeEnter(e),o.onEnter&&await o.onEnter(e)),this.previousPath&&t.isMatch(o.match,this.previousPath)&&o.onLeave&&await o.onLeave(e)}static isMatch(t,e){return"function"==typeof t?t(e):t instanceof RegExp?t.test(e):t===e}on(t,e,o,r){const n=this.generateId(),a={id:n,match:t,onBeforeEnter:r,onEnter:e,onLeave:o};return this.routes.push(a),()=>{this.routes=this.routes.filter((t=>t.id!==n))}}createRender(t){return e=>{console.info(`${t} args=${JSON.stringify(e)}`);const o=document.getElementById("root");o&&(o.innerHTML=`<h2>${t}</h2>`)}}createLogger(){return t=>{console.info(`[leaving] args=${JSON.stringify(t)}`)}}someBeforeEnter(t){return async e=>{if(console.log(`Before entering, args: ${JSON.stringify(e)}`),e.currentPath===t){const e=document.getElementById("root");if(e){const o=document.createElement("div");o.innerHTML=`<h2>BeforeEnter: ${t}</h2>`,e.appendChild(o)}}}}generateId(){const t=()=>Math.floor(Math.random()*this.routes.length*1e3),e=t=>this.routes.some((e=>e.id===t));let o=t();for(;e(o);)o=t();return o}async navigate(t,e){"history"===this.mode?window.history.pushState(e,"",t):window.location.hash=t,await this.handleRouteChange()}}const e=new t("history"),o=e.on(/.*/,e.createRender("/.*"));e.on("/about",e.someBeforeEnter("/about"),e.createRender("/about"),e.createLogger()),e.on("/contacts",e.createRender("/contacts"),e.createLogger()),e.on("/login",e.createRender("/login"),e.createLogger()),e.on("/about/us",e.createRender("/about/us"),e.createLogger()),document.querySelectorAll("a").forEach((t=>{t.href="/otus-SPA-turarov-2023"+t.pathname})),document.body.addEventListener("click",(t=>{const r=t.target;if(r.matches("a")){t.preventDefault();const n=r.getAttribute("href");n&&(e.navigate(n),o())}}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QixJQUVQLE9BQU90QixDQUNULENBRUEsY0FBYTZCLENBQVNqQyxFQUFjUixHQUNoQixZQUFkbkIsS0FBS0QsS0FDUEcsT0FBT2tCLFFBQVF5QyxVQUFVMUMsRUFBTyxHQUFJUSxHQUVwQ3pCLE9BQU9ZLFNBQVNFLEtBQU9XLFFBRW5CM0IsS0FBS0ksbUJBQ2IsRUFHRixNQUFNMEQsRUFBUyxJQUFJcEUsRUFBTyxXQUNwQnFFLEVBQWVELEVBQU9oQyxHQUFHLEtBQU1nQyxFQUFPekIsYUFBYSxRQUV6RHlCLEVBQU9oQyxHQUNMLFNBQ0FnQyxFQUFPZixnQkFBZ0IsVUFDdkJlLEVBQU96QixhQUFhLFVBQ3BCeUIsRUFBT2hCLGdCQUVUZ0IsRUFBT2hDLEdBQUcsWUFBYWdDLEVBQU96QixhQUFhLGFBQWN5QixFQUFPaEIsZ0JBQ2hFZ0IsRUFBT2hDLEdBQUcsU0FBVWdDLEVBQU96QixhQUFhLFVBQVd5QixFQUFPaEIsZ0JBQzFEZ0IsRUFBT2hDLEdBQUcsWUFBYWdDLEVBQU96QixhQUFhLGFBQWN5QixFQUFPaEIsZ0JBRzlEdkMsU0FBU0MsaUJBQWlCLEtBQUtDLFNBQVNDLElBQ2pCQSxFQUNSQyxLQUFPTCx5QkFBU0ksRUFBS0UsUUFBUSxJQUk5Q0wsU0FBU3lELEtBQUs3RCxpQkFBaUIsU0FBVThELElBQ3ZDLE1BQU1DLEVBQVNELEVBQU1DLE9BQ3JCLEdBQUlBLEVBQU9DLFFBQVEsS0FBTSxDQUN2QkYsRUFBTUcsaUJBQ04sTUFBTUMsRUFBTUgsRUFBT0ksYUFBYSxRQUM1QkQsSUFDRlAsRUFBT0YsU0FBU1MsR0FDaEJOLElBRUosSSIsInNvdXJjZXMiOlsid2VicGFjazovL290dXMtc3BhLXR1cmFyb3YtMjAyMy8uL3NyYy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJ0eXBlIFJvdXRlck1vZGUgPSBcImhhc2hcIiB8IFwiaGlzdG9yeVwiO1xyXG5cclxuaW50ZXJmYWNlIEhpc3RvcnlTdGF0ZSB7XHJcbiAgdGl0bGU6IHN0cmluZztcclxufVxyXG50eXBlIE1hdGNoID0gUmVnRXhwIHwgc3RyaW5nIHwgKChwYXRoOiBzdHJpbmcpID0+IGJvb2xlYW4pO1xyXG50eXBlIFJlbmRlckFyZ3MgPSB7XHJcbiAgY3VycmVudFBhdGg6IHN0cmluZztcclxuICBwcmV2aW91c1BhdGg6IHN0cmluZyB8IG51bGw7XHJcbiAgc3RhdGU6IEhpc3RvcnlTdGF0ZTtcclxufTtcclxuaW50ZXJmYWNlIFJvdXRlQXJncyB7XHJcbiAgY3VycmVudFBhdGg6IHN0cmluZztcclxuICBwcmV2aW91c1BhdGg6IHN0cmluZyB8IG51bGw7XHJcbiAgc3RhdGU6IEhpc3RvcnlTdGF0ZTtcclxufVxyXG5cclxudHlwZSBBc3luY1JvdXRlSGFuZGxlciA9IChhcmdzOiBSb3V0ZUFyZ3MpID0+IFByb21pc2U8dm9pZD4gfCB2b2lkO1xyXG5cclxuaW50ZXJmYWNlIExpc3RlbmVyIHtcclxuICBpZDogbnVtYmVyO1xyXG4gIG1hdGNoOiBNYXRjaDtcclxuICBvbkJlZm9yZUVudGVyPzogQXN5bmNSb3V0ZUhhbmRsZXI7XHJcbiAgb25FbnRlcj86IEFzeW5jUm91dGVIYW5kbGVyO1xyXG4gIG9uTGVhdmU/OiBBc3luY1JvdXRlSGFuZGxlcjtcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFJvdXRlciB7XHJcbiAgcHJpdmF0ZSByb3V0ZXM6IExpc3RlbmVyW10gPSBbXTtcclxuXHJcbiAgcHJpdmF0ZSBtb2RlOiBSb3V0ZXJNb2RlO1xyXG5cclxuICBwcml2YXRlIGN1cnJlbnRQYXRoOiBzdHJpbmcgPSBcIlwiO1xyXG5cclxuICBwcml2YXRlIHByZXZpb3VzUGF0aDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XHJcblxyXG4gIGNvbnN0cnVjdG9yKG1vZGU6IFJvdXRlck1vZGUgPSBcImhhc2hcIikge1xyXG4gICAgdGhpcy5tb2RlID0gbW9kZTtcclxuICAgIHRoaXMuY3VycmVudFBhdGggPSB0aGlzLmdldEZyYWdtZW50KCk7XHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcclxuICAgICAgdGhpcy5tb2RlID09PSBcImhhc2hcIiA/IFwiaGFzaGNoYW5nZVwiIDogXCJwb3BzdGF0ZVwiLFxyXG4gICAgICAoKSA9PiB0aGlzLmhhbmRsZVJvdXRlQ2hhbmdlKClcclxuICAgICk7XHJcblxyXG4gICAgdGhpcy5hZGp1c3RMaW5rc0ZvckdIUGFnZXMoKTtcclxuICB9XHJcblxyXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjbGFzcy1tZXRob2RzLXVzZS10aGlzXHJcbiAgcHVibGljIGFkanVzdExpbmtzRm9yR0hQYWdlcygpOiB2b2lkIHtcclxuICAgIGlmIChQUk9EVUNUSU9OKSB7XHJcbiAgICAgIGNvbnN0IFBSRUZJWCA9IFwiL290dXMtU1BBLXR1cmFyb3YtMjAyM1wiO1xyXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiYVwiKS5mb3JFYWNoKChsaW5rKSA9PiB7XHJcbiAgICAgICAgY29uc3QgbW9kaWZpZWRMaW5rID0gbGluaztcclxuICAgICAgICBtb2RpZmllZExpbmsuaHJlZiA9IFBSRUZJWCArIGxpbmsucGF0aG5hbWU7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldEZyYWdtZW50KCk6IHN0cmluZyB7XHJcbiAgICBpZiAodGhpcy5tb2RlID09PSBcImhpc3RvcnlcIikge1xyXG4gICAgICByZXR1cm4gZGVjb2RlVVJJKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSArIHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHdpbmRvdy5sb2NhdGlvbi5oYXNoLnNsaWNlKDEpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGFzeW5jIGhhbmRsZVJvdXRlQ2hhbmdlKCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgdGhpcy5wcmV2aW91c1BhdGggPSB0aGlzLmN1cnJlbnRQYXRoO1xyXG4gICAgdGhpcy5jdXJyZW50UGF0aCA9IHRoaXMuZ2V0RnJhZ21lbnQoKTtcclxuXHJcbiAgICBjb25zdCBhcmdzOiBSb3V0ZUFyZ3MgPSB7XHJcbiAgICAgIGN1cnJlbnRQYXRoOiB0aGlzLmN1cnJlbnRQYXRoLFxyXG4gICAgICBwcmV2aW91c1BhdGg6IHRoaXMucHJldmlvdXNQYXRoLFxyXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1nbG9iYWxzXHJcbiAgICAgIHN0YXRlOiBoaXN0b3J5LnN0YXRlLFxyXG4gICAgfTtcclxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLXN5bnRheFxyXG4gICAgZm9yIChjb25zdCByb3V0ZSBvZiB0aGlzLnJvdXRlcykge1xyXG4gICAgICBpZiAoUm91dGVyLmlzTWF0Y2gocm91dGUubWF0Y2gsIHRoaXMuY3VycmVudFBhdGgpKSB7XHJcbiAgICAgICAgaWYgKHJvdXRlLm9uQmVmb3JlRW50ZXIpXHJcbiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tYXdhaXQtaW4tbG9vcFxyXG4gICAgICAgICAgYXdhaXQgcm91dGUub25CZWZvcmVFbnRlcihhcmdzKTtcclxuICAgICAgICBpZiAocm91dGUub25FbnRlcilcclxuICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1hd2FpdC1pbi1sb29wXHJcbiAgICAgICAgICBhd2FpdCByb3V0ZS5vbkVudGVyKGFyZ3MpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh0aGlzLnByZXZpb3VzUGF0aCAmJiBSb3V0ZXIuaXNNYXRjaChyb3V0ZS5tYXRjaCwgdGhpcy5wcmV2aW91c1BhdGgpKSB7XHJcbiAgICAgICAgaWYgKHJvdXRlLm9uTGVhdmUpXHJcbiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tYXdhaXQtaW4tbG9vcFxyXG4gICAgICAgICAgYXdhaXQgcm91dGUub25MZWF2ZShhcmdzKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIHN0YXRpYyBpc01hdGNoKG1hdGNoOiBNYXRjaCwgcGF0aDogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICBpZiAodHlwZW9mIG1hdGNoID09PSBcImZ1bmN0aW9uXCIpIHtcclxuICAgICAgcmV0dXJuIG1hdGNoKHBhdGgpO1xyXG4gICAgfVxyXG4gICAgaWYgKG1hdGNoIGluc3RhbmNlb2YgUmVnRXhwKSB7XHJcbiAgICAgIHJldHVybiBtYXRjaC50ZXN0KHBhdGgpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG1hdGNoID09PSBwYXRoO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG9uKFxyXG4gICAgbWF0Y2g6IFJlZ0V4cCB8IHN0cmluZyB8ICgocGF0aDogc3RyaW5nKSA9PiBib29sZWFuKSxcclxuICAgIG9uRW50ZXI/OiBBc3luY1JvdXRlSGFuZGxlcixcclxuICAgIG9uTGVhdmU/OiBBc3luY1JvdXRlSGFuZGxlcixcclxuICAgIG9uQmVmb3JlRW50ZXI/OiBBc3luY1JvdXRlSGFuZGxlclxyXG4gICk6ICgpID0+IHZvaWQge1xyXG4gICAgY29uc3QgaWQgPSB0aGlzLmdlbmVyYXRlSWQoKTtcclxuICAgIGNvbnN0IGxpc3RlbmVyOiBMaXN0ZW5lciA9IHsgaWQsIG1hdGNoLCBvbkJlZm9yZUVudGVyLCBvbkVudGVyLCBvbkxlYXZlIH07XHJcbiAgICB0aGlzLnJvdXRlcy5wdXNoKGxpc3RlbmVyKTtcclxuXHJcbiAgICByZXR1cm4gKCk6IHZvaWQgPT4ge1xyXG4gICAgICB0aGlzLnJvdXRlcyA9IHRoaXMucm91dGVzLmZpbHRlcigobCkgPT4gbC5pZCAhPT0gaWQpO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjbGFzcy1tZXRob2RzLXVzZS10aGlzXHJcbiAgcHVibGljIGNyZWF0ZVJlbmRlcihjb250ZW50OiBzdHJpbmcpOiAoYXJnczogUmVuZGVyQXJncykgPT4gdm9pZCB7XHJcbiAgICByZXR1cm4gKGFyZ3M6IFJlbmRlckFyZ3MpID0+IHtcclxuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcclxuICAgICAgY29uc29sZS5pbmZvKGAke2NvbnRlbnR9IGFyZ3M9JHtKU09OLnN0cmluZ2lmeShhcmdzKX1gKTtcclxuICAgICAgY29uc3Qgcm9vdEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJvb3RcIik7XHJcbiAgICAgIGlmIChyb290RWxlbWVudCkge1xyXG4gICAgICAgIHJvb3RFbGVtZW50LmlubmVySFRNTCA9IGA8aDI+JHtjb250ZW50fTwvaDI+YDtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjbGFzcy1tZXRob2RzLXVzZS10aGlzXHJcbiAgcHVibGljIGNyZWF0ZUxvZ2dlcigpOiAoYXJnczogUm91dGVBcmdzKSA9PiB2b2lkIHtcclxuICAgIHJldHVybiAoYXJnczogUm91dGVBcmdzKTogdm9pZCA9PiB7XHJcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXHJcbiAgICAgIGNvbnNvbGUuaW5mbyhgW2xlYXZpbmddIGFyZ3M9JHtKU09OLnN0cmluZ2lmeShhcmdzKX1gKTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY2xhc3MtbWV0aG9kcy11c2UtdGhpc1xyXG4gIHB1YmxpYyBzb21lQmVmb3JlRW50ZXIoY29udGVudDogc3RyaW5nKTogKGFyZ3M6IFJvdXRlQXJncykgPT4gUHJvbWlzZTx2b2lkPiB7XHJcbiAgICByZXR1cm4gYXN5bmMgKGFyZ3M6IFJvdXRlQXJncyk6IFByb21pc2U8dm9pZD4gPT4ge1xyXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxyXG4gICAgICBjb25zb2xlLmxvZyhgQmVmb3JlIGVudGVyaW5nLCBhcmdzOiAke0pTT04uc3RyaW5naWZ5KGFyZ3MpfWApO1xyXG4gICAgICBpZiAoYXJncy5jdXJyZW50UGF0aCA9PT0gY29udGVudCkge1xyXG4gICAgICAgIGNvbnN0IHJvb3RFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyb290XCIpO1xyXG4gICAgICAgIGlmIChyb290RWxlbWVudCkge1xyXG4gICAgICAgICAgY29uc3QgbmV3RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICBuZXdFbGVtZW50LmlubmVySFRNTCA9IGA8aDI+QmVmb3JlRW50ZXI6ICR7Y29udGVudH08L2gyPmA7XHJcbiAgICAgICAgICByb290RWxlbWVudC5hcHBlbmRDaGlsZChuZXdFbGVtZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2VuZXJhdGVJZCgpOiBudW1iZXIge1xyXG4gICAgY29uc3QgZ2V0UmFuZG9tTnVtYmVyID0gKCk6IG51bWJlciA9PlxyXG4gICAgICBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0aGlzLnJvdXRlcy5sZW5ndGggKiAxMDAwKTtcclxuXHJcbiAgICBjb25zdCBkb2VzRXhpc3QgPSAoaWQ6IG51bWJlcik6IGJvb2xlYW4gPT5cclxuICAgICAgdGhpcy5yb3V0ZXMuc29tZSgocm91dGUpID0+IHJvdXRlLmlkID09PSBpZCk7XHJcblxyXG4gICAgbGV0IGlkID0gZ2V0UmFuZG9tTnVtYmVyKCk7XHJcbiAgICB3aGlsZSAoZG9lc0V4aXN0KGlkKSkge1xyXG4gICAgICBpZCA9IGdldFJhbmRvbU51bWJlcigpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGlkO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGFzeW5jIG5hdmlnYXRlKHBhdGg6IHN0cmluZywgc3RhdGU/OiBIaXN0b3J5U3RhdGUpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGlmICh0aGlzLm1vZGUgPT09IFwiaGlzdG9yeVwiKSB7XHJcbiAgICAgIHdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZShzdGF0ZSwgXCJcIiwgcGF0aCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB3aW5kb3cubG9jYXRpb24uaGFzaCA9IHBhdGg7XHJcbiAgICB9XHJcbiAgICBhd2FpdCB0aGlzLmhhbmRsZVJvdXRlQ2hhbmdlKCk7XHJcbiAgfVxyXG59XHJcblxyXG5jb25zdCByb3V0ZXIgPSBuZXcgUm91dGVyKFwiaGlzdG9yeVwiKTtcclxuY29uc3QgdW5zdWJzY3JpYmVyID0gcm91dGVyLm9uKC8uKi8sIHJvdXRlci5jcmVhdGVSZW5kZXIoXCIvLipcIikpO1xyXG4vLyByb3V0ZXIub24oKHBhdGgpID0+IHBhdGggPT09IFwiL2NvbnRhY3RzXCIsIHJvdXRlci5jcmVhdGVSZW5kZXIoXCIvY29udGFjdHNcIikpO1xyXG5yb3V0ZXIub24oXHJcbiAgXCIvYWJvdXRcIixcclxuICByb3V0ZXIuc29tZUJlZm9yZUVudGVyKFwiL2Fib3V0XCIpLFxyXG4gIHJvdXRlci5jcmVhdGVSZW5kZXIoXCIvYWJvdXRcIiksXHJcbiAgcm91dGVyLmNyZWF0ZUxvZ2dlcigpXHJcbik7XHJcbnJvdXRlci5vbihcIi9jb250YWN0c1wiLCByb3V0ZXIuY3JlYXRlUmVuZGVyKFwiL2NvbnRhY3RzXCIpLCByb3V0ZXIuY3JlYXRlTG9nZ2VyKCkpO1xyXG5yb3V0ZXIub24oXCIvbG9naW5cIiwgcm91dGVyLmNyZWF0ZVJlbmRlcihcIi9sb2dpblwiKSwgcm91dGVyLmNyZWF0ZUxvZ2dlcigpKTtcclxucm91dGVyLm9uKFwiL2Fib3V0L3VzXCIsIHJvdXRlci5jcmVhdGVSZW5kZXIoXCIvYWJvdXQvdXNcIiksIHJvdXRlci5jcmVhdGVMb2dnZXIoKSk7XHJcblxyXG5pZiAoUFJPRFVDVElPTikge1xyXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJhXCIpLmZvckVhY2goKGxpbmspID0+IHtcclxuICAgIGNvbnN0IG1vZGlmaWVkTGluayA9IGxpbms7XHJcbiAgICBtb2RpZmllZExpbmsuaHJlZiA9IFBSRUZJWCArIGxpbmsucGF0aG5hbWU7XHJcbiAgfSk7XHJcbn1cclxuXHJcbmRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldmVudCkgPT4ge1xyXG4gIGNvbnN0IHRhcmdldCA9IGV2ZW50LnRhcmdldCBhcyBIVE1MRWxlbWVudDtcclxuICBpZiAodGFyZ2V0Lm1hdGNoZXMoXCJhXCIpKSB7XHJcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgY29uc3QgdXJsID0gdGFyZ2V0LmdldEF0dHJpYnV0ZShcImhyZWZcIik7XHJcbiAgICBpZiAodXJsKSB7XHJcbiAgICAgIHJvdXRlci5uYXZpZ2F0ZSh1cmwpO1xyXG4gICAgICB1bnN1YnNjcmliZXIoKTtcclxuICAgIH1cclxuICB9XHJcbn0pO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgUm91dGVyO1xyXG4iXSwibmFtZXMiOlsiUm91dGVyIiwicm91dGVzIiwiY3VycmVudFBhdGgiLCJwcmV2aW91c1BhdGgiLCJjb25zdHJ1Y3RvciIsIm1vZGUiLCJ0aGlzIiwiZ2V0RnJhZ21lbnQiLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwiaGFuZGxlUm91dGVDaGFuZ2UiLCJhZGp1c3RMaW5rc0ZvckdIUGFnZXMiLCJQUkVGSVgiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwibGluayIsImhyZWYiLCJwYXRobmFtZSIsImRlY29kZVVSSSIsImxvY2F0aW9uIiwic2VhcmNoIiwiaGFzaCIsInNsaWNlIiwiYXJncyIsInN0YXRlIiwiaGlzdG9yeSIsInJvdXRlIiwiaXNNYXRjaCIsIm1hdGNoIiwib25CZWZvcmVFbnRlciIsIm9uRW50ZXIiLCJvbkxlYXZlIiwicGF0aCIsIlJlZ0V4cCIsInRlc3QiLCJvbiIsImlkIiwiZ2VuZXJhdGVJZCIsImxpc3RlbmVyIiwicHVzaCIsImZpbHRlciIsImwiLCJjcmVhdGVSZW5kZXIiLCJjb250ZW50IiwiY29uc29sZSIsImluZm8iLCJKU09OIiwic3RyaW5naWZ5Iiwicm9vdEVsZW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImlubmVySFRNTCIsImNyZWF0ZUxvZ2dlciIsInNvbWVCZWZvcmVFbnRlciIsImFzeW5jIiwibG9nIiwibmV3RWxlbWVudCIsImNyZWF0ZUVsZW1lbnQiLCJhcHBlbmRDaGlsZCIsImdldFJhbmRvbU51bWJlciIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImxlbmd0aCIsImRvZXNFeGlzdCIsInNvbWUiLCJuYXZpZ2F0ZSIsInB1c2hTdGF0ZSIsInJvdXRlciIsInVuc3Vic2NyaWJlciIsImJvZHkiLCJldmVudCIsInRhcmdldCIsIm1hdGNoZXMiLCJwcmV2ZW50RGVmYXVsdCIsInVybCIsImdldEF0dHJpYnV0ZSJdLCJzb3VyY2VSb290IjoiIn0=